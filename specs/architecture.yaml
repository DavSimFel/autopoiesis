# Architecture constraints — verified by scripts/arch_check.py
# See issue #156 for rationale.
# 2026-02-18: Fixed typo in arch_check.py constant (_AUTOPIESIS → _AUTOPOIESIS).

# Module dependency rules: module -> allowed internal imports
dependencies:
  agent: [models, store, tools, infra, approval, display, topics, toolset_builder, model_resolution, run_simple, prompts, server]
  server: [agent, models, store, approval, infra, display, tools, chat, db, topics, toolset_builder, model_resolution, skills, skillmaker_tools, prompts, io_utils, run_simple]
  tools: [models, store, infra, db, agent, topics, security, skills]  # agent: exec_tool enqueues work items
  store: [db, models]
  infra: [models, db, store, topics, tools, security]
  approval: [models, db]
  display: [models, infra]
  topics: []
  security: []  # security module has no internal dependencies
  skills: [security]  # skills can import from security module
  # Root modules (chat, toolset_builder, etc.) are not constrained here

# Explicitly forbidden imports (regardless of dependency rules)
forbidden:
  - tools -> server        # tools must not know about server
  - store -> agent         # store must not know about agent
  - store -> server        # store must not know about server
  - approval -> agent      # approval must not know about agent
  - approval -> server     # approval must not know about server

# Maximum lines per file
max_lines: 300

# Files exempt from max_lines (pre-existing, to be refactored)
max_lines_exempt:
  - src/autopoiesis/store/knowledge.py     # 340 lines — tracked for refactor
  - src/autopoiesis/topics/topic_manager.py  # 445 lines — new module, to be refactored
  - src/autopoiesis/agent/context.py       # 366 lines — context/token estimation, tracked for split (#193)
  - src/autopoiesis/server/api_routes.py   # 340 lines — REST API layer, tracked for split (#221)
  - src/autopoiesis/agent/runtime.py       # 348 lines — agent runtime, tracked for refactor (#202)
  - src/autopoiesis/tools/toolset_builder.py  # 327 lines — toolset wiring, tracked for split (#202)

# Pattern constraints — these strings must not appear in source
no_globals: []
